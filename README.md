# livekit-memory-leak-demo

I have tested this on Python 3.11.7 / 3.12.6 / 3.13.2, and all seem to have memory leak issue. 

I cannot reproduce this every time, but it turns out that this is very likely to happen.

# Reproduce Memory Leak Process

## Prerequisites

Make sure all the keys have been replaced with correct one in *config.py*

## Step 1

Execute *start_worker.py*.

```
python start_worker.py
```



## Step 2

Execute *create_room.py*. Since the agent has no name, once the room is created, our agent will be dispatched to the room.

```
python create_room.py
```



## Step 3

Connect to the room via https://agents-playground.livekit.io/ with the url and token generated by Step 2.



## Step 4

Start speaking like this:

### Step 4.1

Say "Hello", and wait for agent to finish replying.

### Step 4.2

Say "How are you today", and wait for agent to finish replying.

### Step 4.3

Say "What's the weather like today", and wait for agent to finish replying.

### Step 4.4

Disconnect in  https://agents-playground.livekit.io/, and wait for the session to be closed completely. You will see something on your console like tihs:

```
livekit::rtc_engine:446:livekit::rtc_engine - received session close: "signal client closed: \"stream closed\"
```



## Step 5

Repeat Step 3 and Step 4 for one time. 



## Step 6

Repeat Step 3 and Step 4.1, and then mute the audio and video input, and wait until the plt completed. You'll see this on your console:

``` 
Plt is done. You can quit now.
```

At this time, an image named **line_graph_demo.png** will be generaded under the directory, which containing memory usage during last 10 mins.
